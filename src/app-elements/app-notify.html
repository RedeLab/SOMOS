<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="./app-icons.html">

<dom-module id="app-notify">
  <template>
    <style>
      :host {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 350px;
        max-width: 100%;
      }
      .dismiss {
        float: right;
      }
      #status5 {
        --paper-toast-background-color: var(--error-color);
        --paper-toast-color: var(--text-primary-color);
      }
      #status4 {
        --paper-toast-background-color: var(--warning-color);
        --paper-toast-color: var(--primary-text-color);
      }
      #status1 {
        --paper-toast-background-color: var(--info-color);
        --paper-toast-color: var(--primary-text-color);
      }
    </style>
    <paper-toast id="status5" duration="9000"
      text="{{message}}" class="fit-bottom">
      <paper-icon-button class="dismiss" icon="app:close" on-tap="close"></paper-icon-button>
    </paper-toast>
    <paper-toast id="status4" duration="6000"
      text="{{message}}" class="fit-bottom">
      <paper-icon-button class="dismiss" icon="app:close" on-tap="close"></paper-icon-button>
    </paper-toast>
    <paper-toast id="status1" duration="3000"
      text="{{message}}" class="fit-bottom">
      <paper-icon-button class="dismiss" icon="app:close" on-tap="close"></paper-icon-button>
    </paper-toast>
  </template>
  <script>
    class AppNotify extends Polymer.Element {
      static get is() { return 'app-notify'; }
      static get properties() {
        return {
          error: {
            type: Object,
            observer: 'showMessage'
          },
          status: {
            type: String
          },
          message: {
            type: String
          },
          useKeyIfMissing: {
            value: true
          }
        };
      }

      showMessage(error) {
        if(error && error.status) {
          var code =  Number(error.status) ?
            Math.round(error.status/100) : 1;
          this.status = "status"+code;
          if(this.$[this.status])
            this.$[this.status].show();
          switch(code) {
            case 4:
              this.message = 'Credenciais inv√°lidas';
              break;
            case 5:
              this.message = 'Erro no Servidor. Tente novamente mais tarde.';
              break;
            default:
              this.message = error.statusText;
          }
        }
      }

      close() {
        if(this.$[this.status])
          this.$[this.status].close();
      }
    }
    customElements.define(AppNotify.is, AppNotify);
  </script>
</dom-module>
