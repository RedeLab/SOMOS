<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">

<link rel="import" href="../app-elements/app-icons.html">
<link rel="import" href="../app-elements/shared-styles.html">

<dom-module id="proposal-dialog">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        height: 100vh;
      }
      paper-dropdown-menu {
        width: 100%;
      }
      .submit {
        text-align: right;
        margin-top: 15px;
      }
    </style>
      <paper-input label="Titulo" placeholder="Nome da proposta" value="{{proposal.title}}"></paper-input>
      <paper-dropdown-menu label="Categoria" value="{{proposal.category}}">
        <paper-listbox slot="dropdown-content" class="dropdown-content">
          <template id="statesList" is="dom-repeat" items="{{categories}}" as="category">
            <paper-item>{{category}}</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      <paper-textarea label="Descrição" placeholder="Uma descrição da proposta que pode ser escrita aqui" char-counter rows="2" max-rows="2" maxlength="1000" value="{{proposal.description}}"></paper-textarea>
      <div class="file-upload">
        <paper-input label="Imagem ilustrativa" placeholder="Selecione uma imagem" value="{{proposal.image}}">
          <iron-icon icon="app:cloud-upload" slot="suffix"></iron-icon>
        </paper-input>
        <input id="image" type="file" on-change="getFileName" accept=".jpg, .jpeg, .png">
      </div>
      <div class="submit">
        <paper-button class="plain" on-tap="_saveProposal">Criar Proposta</paper-button>
      </div>
  </template>
  <script>
    class ProposalDialog extends Polymer.Element {
      static get is() { return 'proposal-dialog'; }
      static get properties() {
        return {
          proposal: {
            type: Object,
            value: function () { return {}; }
          },
          proposals: {
            type: Array,
            value: [],
            notify: true
          },
          categories: {
            type: Array,
            value: ["Educação", "Gestão Pública e Economia", "Democracia de Alta Intensidade", "Infraestrutura", "Segurança Pública", "Pacto Federativo e Municipalismo", "Utilização dos recursos naturais", "Trabalho no campo a na cidade", "Esportes e cidades"]
          }
        };
      }

      _saveProposal() {
        const proposal = JSON.parse(JSON.stringify(this.proposal));
        this.dispatchEvent(new CustomEvent('create-proposal', { detail: { proposal }}));
        this.proposal = {};
      }

      getFileName(e) {
        let filename = e.target.files[0].name;
        const input = this.shadowRoot.querySelector('.file-upload paper-input');
        input.value = filename;
      }
      
    }
    window.customElements.define(ProposalDialog.is, ProposalDialog);
  </script>
</dom-module>